(function(){function b(c,g,d){var f=c.getWrapperElement();var e;e=f.appendChild(document.createElement("div"));if(d){e.className="CodeMirror-dialog CodeMirror-dialog-bottom"}else{e.className="CodeMirror-dialog CodeMirror-dialog-top"}if(typeof g=="string"){e.innerHTML=g}else{e.appendChild(g)}return e}function a(c,d){if(c.state.currentNotificationClose){c.state.currentNotificationClose()}c.state.currentNotificationClose=d}CodeMirror.defineExtension("openDialog",function(h,i,k){a(this,null);var e=b(this,h,k&&k.bottom);var d=false,f=this;function j(){if(d){return}d=true;e.parentNode.removeChild(e)}var g=e.getElementsByTagName("input")[0],c;if(g){CodeMirror.on(g,"keydown",function(l){if(k&&k.onKeyDown&&k.onKeyDown(l,g.value,j)){return}if(l.keyCode==13||l.keyCode==27){CodeMirror.e_stop(l);j();f.focus();if(l.keyCode==13){i(g.value)}}});if(k&&k.onKeyUp){CodeMirror.on(g,"keyup",function(l){k.onKeyUp(l,g.value,j)})}if(k&&k.value){g.value=k.value}g.focus();CodeMirror.on(g,"blur",j)}else{if(c=e.getElementsByTagName("button")[0]){CodeMirror.on(c,"click",function(){j();f.focus()});c.focus();CodeMirror.on(c,"blur",j)}}return j});CodeMirror.defineExtension("openConfirm",function(l,f,n){a(this,null);var g=b(this,l,n&&n.bottom);var h=g.getElementsByTagName("button");var e=false,j=this,c=1;function m(){if(e){return}e=true;g.parentNode.removeChild(g);j.focus()}h[0].focus();for(var d=0;d<h.length;++d){var k=h[d];(function(i){CodeMirror.on(k,"click",function(o){CodeMirror.e_preventDefault(o);m();if(i){i(j)}})})(f[d]);CodeMirror.on(k,"blur",function(){--c;setTimeout(function(){if(c<=0){m()}},200)});CodeMirror.on(k,"focus",function(){++c})}});CodeMirror.defineExtension("openNotification",function(f,d){a(this,i);var e=b(this,f,d&&d.bottom);var h=d&&(d.duration===undefined?5000:d.duration);var c=false,g;function i(){if(c){return}c=true;clearTimeout(g);e.parentNode.removeChild(e)}CodeMirror.on(e,"click",function(j){CodeMirror.e_preventDefault(j);i()});if(h){g=setTimeout(i,d.duration)}})})();(function(){function a(p){if(typeof p=="string"){return{token:function(q){if(q.match(p)){return"searching"}q.next();q.skipTo(p.charAt(0))||q.skipToEnd()}}}return{token:function(q){if(q.match(p)){return"searching"}while(!q.eol()){q.next();if(q.match(p,false)){break}}}}}function l(){this.posFrom=this.posTo=this.query=null;this.overlay=null}function g(p){return p.state.search||(p.state.search=new l())}function n(p,q,r){return p.getSearchCursor(q,r,typeof q=="string"&&q==q.toLowerCase())}function k(p,s,q,r){if(p.openDialog){p.openDialog(s,r)}else{r(prompt(q,""))}}function o(q,s,r,p){if(q.openConfirm){q.openConfirm(s,p)}else{if(confirm(r)){p[0]()}}}function d(q){var p=q.match(/^\/(.*)\/([a-z]*)$/);return p?new RegExp(p[1],p[2].indexOf("i")==-1?"":"i"):q}var c='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';function j(p,q){var r=g(p);if(r.query){return h(p,q)}k(p,c,"Search for:",function(s){p.operation(function(){if(!s||r.query){return}r.query=d(s);p.removeOverlay(r.overlay);r.overlay=a(r.query);p.addOverlay(r.overlay);r.posFrom=r.posTo=p.getCursor();h(p,q)})})}function h(p,q){p.operation(function(){var r=g(p);var s=n(p,r.query,q?r.posFrom:r.posTo);if(!s.find(q)){s=n(p,r.query,q?CodeMirror.Pos(p.lastLine()):CodeMirror.Pos(p.firstLine(),0));if(!s.find(q)){return}}p.setSelection(s.from(),s.to());p.scrollIntoView({from:s.from(),to:s.to()});r.posFrom=s.from();r.posTo=s.to()})}function m(p){p.operation(function(){var q=g(p);if(!q.query){return}q.query=null;p.removeOverlay(q.overlay)})}var f='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';var i='With: <input type="text" style="width: 10em"/>';var e="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function b(p,q){k(p,f,"Replace:",function(r){if(!r){return}r=d(r);k(p,i,"Replace with:",function(v){if(q){p.operation(function(){for(var x=n(p,r);x.findNext();){if(typeof r!="string"){var w=p.getRange(x.from(),x.to()).match(r);x.replace(v.replace(/\$(\d)/,function(y,z){return w[z]}))}else{x.replace(v)}}})}else{m(p);var u=n(p,r,p.getCursor());var t=function(){var x=u.from(),w;if(!(w=u.findNext())){u=n(p,r);if(!(w=u.findNext())||(x&&u.from().line==x.line&&u.from().ch==x.ch)){return}}p.setSelection(u.from(),u.to());p.scrollIntoView({from:u.from(),to:u.to()});o(p,e,"Replace?",[function(){s(w)},t])};var s=function(w){u.replace(typeof r=="string"?v:v.replace(/\$(\d)/,function(x,y){return w[y]}));t()};t()}})})}CodeMirror.commands.find=function(p){m(p);j(p)};CodeMirror.commands.findNext=j;CodeMirror.commands.findPrev=function(p){j(p,true)};CodeMirror.commands.clearSearch=m;CodeMirror.commands.replace=b;CodeMirror.commands.replaceAll=function(p){b(p,true)}})();(function(){var a=CodeMirror.Pos;function b(g,e,h,d){this.atOccurrence=false;this.doc=g;if(d==null&&typeof e=="string"){d=false}h=h?g.clipPos(h):a(0,0);this.pos={from:h,to:h};if(typeof e!="string"){if(!e.global){e=new RegExp(e.source,e.ignoreCase?"ig":"g")}this.matches=function(l,p){if(l){e.lastIndex=0;var i=g.getLine(p.line).slice(0,p.ch),n=0,k,o;for(;;){e.lastIndex=n;var m=e.exec(i);if(!m){break}k=m;o=k.index;n=k.index+(k[0].length||1);if(n==i.length){break}}var j=(k&&k[0].length)||0;if(!j){if(o==0&&i.length==0){k=undefined}else{if(o!=g.getLine(p.line).length){j++}}}}else{e.lastIndex=p.ch;var i=g.getLine(p.line),k=e.exec(i);var j=(k&&k[0].length)||0;var o=k&&k.index;if(o+j!=i.length&&!j){j=1}}if(k&&j){return{from:a(p.line,o),to:a(p.line,o+j),match:k}}}}else{if(d){e=e.toLowerCase()}var c=d?function(i){return i.toLowerCase()}:function(i){return i};var f=e.split("\n");if(f.length==1){if(!e.length){this.matches=function(){}}else{this.matches=function(l,m){var j=c(g.getLine(m.line)),i=e.length,k;if(l?(m.ch>=i&&(k=j.lastIndexOf(e,m.ch-i))!=-1):(k=j.indexOf(e,m.ch))!=-1){return{from:a(m.line,k),to:a(m.line,k+i)}}}}}else{this.matches=function(n,p){var o=p.line,q=(n?f.length-1:0),l=f[q],r=c(g.getLine(o));var m=(n?r.indexOf(l)+l.length:r.lastIndexOf(l));if(n?m>p.ch||m!=l.length:m<p.ch||m!=r.length-l.length){return}for(;;){if(n?!o:o==g.lineCount()-1){return}r=c(g.getLine(o+=n?-1:1));l=f[n?--q:++q];if(q>0&&q<f.length-1){if(r!=l){return}else{continue}}var k=(n?r.lastIndexOf(l):r.indexOf(l)+l.length);if(n?k!=r.length-l.length:k!=l.length){return}var i=a(p.line,m),j=a(o,k);return{from:n?j:i,to:n?i:j}}}}}}b.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(d){var c=this,g=this.doc.clipPos(d?this.pos.from:this.pos.to);function e(h){var i=a(h,0);c.pos={from:i,to:i};c.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(d,g)){if(!this.pos.from||!this.pos.to){console.log(this.matches,this.pos)}this.atOccurrence=true;return this.pos.match||true}if(d){if(!g.line){return e(0)}g=a(g.line-1,this.doc.getLine(g.line-1).length)}else{var f=this.doc.lineCount();if(g.line==f-1){return e(f)}g=a(g.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(d){if(!this.atOccurrence){return}var c=CodeMirror.splitLines(d);this.doc.replaceRange(c,this.pos.from,this.pos.to);this.pos.to=a(this.pos.from.line+c.length-1,c[c.length-1].length+(c.length==1?this.pos.from.ch:0))}};CodeMirror.defineExtension("getSearchCursor",function(d,e,c){return new b(this.doc,d,e,c)});CodeMirror.defineDocExtension("getSearchCursor",function(d,e,c){return new b(this,d,e,c)})})();