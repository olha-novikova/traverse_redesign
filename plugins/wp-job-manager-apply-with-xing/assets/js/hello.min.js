/**
 * @hello.js
 *
 * HelloJS is a client side Javascript SDK for making OAuth2 logins and subsequent REST calls.
 *
 * @author Andrew Dodson
 * @company Knarly
 *
 * @copyright Andrew Dodson, 2012 - 2013
 * @license MIT: You are free to use and modify this code for any use, on the condition that this copyright notice remains.
 */
var hello=function(a){return hello.use(a)};hello.utils={extend:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];if(a instanceof Object&&d instanceof Object&&a!==d)for(var e in d)a[e]=hello.utils.extend(a[e],d[e]);else a=d}return a}},hello.utils.extend(hello,{settings:{redirect_uri:window.location.href.split("#")[0],response_type:"token",display:"popup",state:"",oauth_proxy:"https://auth-server.herokuapp.com/proxy",timeout:2e4,default_service:null,force:!0,page_uri:window.location.href},service:function(a){return"undefined"!=typeof a?this.utils.store("sync_service",a):this.utils.store("sync_service")},services:{},use:function(a){var b=this.utils.objectCreate(this);return b.settings=this.utils.objectCreate(this.settings),a&&(b.settings.default_service=a),b.utils.Event.call(b),b},init:function(a,b){var c=this.utils;if(!a)return this.services;for(var d in a)a.hasOwnProperty(d)&&"object"!=typeof a[d]&&(a[d]={id:a[d]});c.extend(this.services,a);for(d in this.services)this.services.hasOwnProperty(d)&&(this.services[d].scope=this.services[d].scope||{});return b&&(c.extend(this.settings,b),"redirect_uri"in b&&(this.settings.redirect_uri=c.url(b.redirect_uri).href)),this},login:function(){var a=this.use(),b=a.utils,c=b.args({network:"s",options:"o",callback:"f"},arguments);a.args=c;var d,e=c.options=b.merge(a.settings,c.options||{});if(c.network=a.settings.default_service=c.network||a.settings.default_service,a.on("complete",c.callback),"string"!=typeof c.network||!(c.network in a.services))return a.emitAfter("error complete",{error:{code:"invalid_network",message:"The provided network was not recognized"}}),a;var f=a.services[c.network],g=!1,h=b.globalEvent(function(c){var d;d=c?JSON.parse(c):{error:{code:"cancelled",message:"The authentication was not completed"}},g=!0,d.error?a.emit("complete error failed auth.failed",{error:d.error}):(b.store(d.network,d),a.emit("complete success login auth.login auth",{network:d.network,authResponse:d}))}),i=b.url(e.redirect_uri).href,j=f.oauth.response_type||e.response_type;"code"!==j||f.oauth.grant||(j="token"),c.qs={client_id:f.id,response_type:j,redirect_uri:i,display:e.display,scope:"basic",state:{client_id:f.id,network:c.network,display:e.display,callback:h,state:e.state,redirect_uri:i}};var k=b.store(c.network),l=(e.scope||"").toString();if(l=(l?l+",":"")+c.qs.scope,k&&"scope"in k&&k.scope instanceof String&&(l+=","+k.scope),c.qs.state.scope=b.unique(l.split(/[,\s]+/)).join(","),c.qs.scope=l.replace(/[^,\s]+/gi,function(b){if(b in f.scope)return f.scope[b];for(var c in a.services){var d=a.services[c].scope;if(d&&b in d)return""}return b}).replace(/[,\s]+/gi,","),c.qs.scope=b.unique(c.qs.scope.split(/,+/)).join(f.scope_delim||","),e.force===!1&&k&&"access_token"in k&&k.access_token&&"expires"in k&&k.expires>(new Date).getTime()/1e3){var m=b.diff(k.scope||[],c.qs.state.scope||[]);if(0===m.length)return a.emitAfter("complete success login",{unchanged:!0,network:c.network,authResponse:k}),a}if("page"===e.display&&e.page_uri&&(c.qs.state.page_uri=b.url(e.page_uri).href),"login"in f&&"function"==typeof f.login&&f.login(c),("token"!==j||parseInt(f.oauth.version,10)<2||"none"===e.display&&f.oauth.grant&&k&&k.refresh_token)&&(c.qs.state.oauth=f.oauth,c.qs.state.oauth_proxy=e.oauth_proxy),c.qs.state=JSON.stringify(c.qs.state),1===parseInt(f.oauth.version,10)?d=b.qs(e.oauth_proxy,c.qs):"none"===e.display&&f.oauth.grant&&k&&k.refresh_token?(c.qs.refresh_token=k.refresh_token,d=b.qs(e.oauth_proxy,c.qs)):d=b.qs(f.oauth.auth,c.qs),a.emit("notice","Authorization URL "+d),"none"===e.display)b.iframe(d);else if("popup"===e.display)var n=b.popup(d,i,e.window_width||500,e.window_height||550),o=setInterval(function(){if((!n||n.closed)&&(clearInterval(o),!g)){var b={code:"cancelled",message:"Login has been cancelled"};n||(b={code:"blocked",message:"Popup was blocked"}),a.emit("complete failed error",{error:b,network:c.network})}},100);else window.location=d;return a},logout:function(){var a=this.use(),b=a.utils,c=b.args({name:"s",options:"o",callback:"f"},arguments);if(c.options=c.options||{},a.on("complete",c.callback),c.name=c.name||a.settings.default_service,!c.name||c.name in a.services)if(c.name&&b.store(c.name)){var d=function(b){a.utils.store(c.name,""),a.emitAfter("complete logout success auth.logout auth",hello.utils.merge({network:c.name},b||{}))},e={};if(c.options.force){var f=a.services[c.name].logout;if(f)if("function"==typeof f&&(f=f(d)),"string"==typeof f)b.iframe(f),e.force=null,e.message="Logout success on providers site was indeterminate";else if(void 0===f)return a}d(e)}else if(c.name)a.emitAfter("complete error",{error:{code:"invalid_session",message:"There was no session to remove"}});else{for(var g in a.services)a.services.hasOwnProperty(g)&&a.logout(g);a.service(!1)}else a.emitAfter("complete error",{error:{code:"invalid_network",message:"The network was unrecognized"}});return a},getAuthResponse:function(a){return a=a||this.settings.default_service,a&&a in this.services?this.utils.store(a)||null:(this.emit("complete error",{error:{code:"invalid_network",message:"The network was unrecognized"}}),null)},events:{}}),hello.utils.extend(hello.utils,{qs:function(a,b){if(b){var c;for(var d in b)if(a.indexOf(d)>-1){var e="[\\?\\&]"+d+"=[^\\&]*";c=new RegExp(e),a=a.replace(c,"")}}return a+(this.isEmpty(b)?"":(a.indexOf("?")>-1?"&":"?")+this.param(b))},param:function(a){var b,c,d={};if("string"==typeof a){if(c=a.replace(/^[\#\?]/,"").match(/([^=\/\&]+)=([^\&]+)/g))for(var e=0;e<c.length;e++)b=c[e].match(/([^=]+)=(.*)/),d[b[1]]=decodeURIComponent(b[2]);return d}var f=a;d=[];for(var g in f)f.hasOwnProperty(g)&&f.hasOwnProperty(g)&&d.push([g,"?"===f[g]?"?":encodeURIComponent(f[g])].join("="));return d.join("&")},store:function(a){function b(){var b={};try{b=JSON.parse(a.getItem("hello"))||{}}catch(c){}return b}function c(b){a.setItem("hello",JSON.stringify(b))}var d=[a,window.sessionStorage],e=0;for(a=d[e++];a;)try{a.setItem(e,e),a.removeItem(e);break}catch(f){a=d[e++]}return a||(a={getItem:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].replace(/(^\s+|\s+$)/,"");if(d&&0===d.indexOf(a))return d.substr(a.length)}return null},setItem:function(a,b){document.cookie=a+"="+b}}),function(a,d,e){var f=b();if(a&&void 0===d)return f[a]||null;if(a&&null===d)try{delete f[a]}catch(g){f[a]=null}else{if(!a)return f;f[a]=d}return c(f),f||null}}(window.localStorage),append:function(a,b,c){var d="string"==typeof a?document.createElement(a):a;if("object"==typeof b)if("tagName"in b)c=b;else for(var e in b)if(b.hasOwnProperty(e))if("object"==typeof b[e])for(var f in b[e])b[e].hasOwnProperty(f)&&(d[e][f]=b[e][f]);else"html"===e?d.innerHTML=b[e]:/^on/.test(e)?d[e]=b[e]:d.setAttribute(e,b[e]);return"body"===c?!function g(){document.body?document.body.appendChild(d):setTimeout(g,16)}():"object"==typeof c?c.appendChild(d):"string"==typeof c&&document.getElementsByTagName(c)[0].appendChild(d),d},iframe:function(a){this.append("iframe",{src:a,style:{position:"absolute",left:"-1000px",bottom:0,height:"1px",width:"1px"}},"body")},merge:function(){var a=Array.prototype.slice.call(arguments);return a.unshift({}),this.extend.apply(null,a)},args:function(a,b){var c={},d=0,e=null,f=null;for(f in a)if(a.hasOwnProperty(f))break;if(1===b.length&&"object"==typeof b[0]&&"o!"!=a[f])for(f in b[0])if(a.hasOwnProperty(f)&&f in a)return b[0];for(f in a)if(a.hasOwnProperty(f))if(e=typeof b[d],"function"==typeof a[f]&&a[f].test(b[d])||"string"==typeof a[f]&&(a[f].indexOf("s")>-1&&"string"===e||a[f].indexOf("o")>-1&&"object"===e||a[f].indexOf("i")>-1&&"number"===e||a[f].indexOf("a")>-1&&"object"===e||a[f].indexOf("f")>-1&&"function"===e))c[f]=b[d++];else if("string"==typeof a[f]&&a[f].indexOf("!")>-1)return!1;return c},url:function(a){if(a){if(window.URL&&URL instanceof Function&&0!==URL.length)return new URL(a,window.location);var b=document.createElement("a");return b.href=a,b}return window.location},diff:function(a,b){for(var c=[],d=0;d<b.length;d++)-1===this.indexOf(a,b[d])&&c.push(b[d]);return c},indexOf:function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},unique:function(a){if("object"!=typeof a)return[];for(var b=[],c=0;c<a.length;c++)a[c]&&0!==a[c].length&&-1===this.indexOf(b,a[c])&&b.push(a[c]);return b},isEmpty:function(a){if(!a)return!0;if(a&&a.length>0)return!1;if(a&&0===a.length)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},objectCreate:function(){function a(){}return Object.create?Object.create:function(b){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}(),Event:function(){var a=/[\s\,]+/;return this.parent={events:this.events,findEvents:this.findEvents,parent:this.parent,utils:this.utils},this.events={},this.on=function(b,c){if(c&&"function"==typeof c)for(var d=b.split(a),e=0;e<d.length;e++)this.events[d[e]]=[c].concat(this.events[d[e]]||[]);return this},this.off=function(a,b){return this.findEvents(a,function(a,c){b&&this.events[a][c]!==b||(this.events[a][c]=null)}),this},this.emit=function(a){var b=Array.prototype.slice.call(arguments,1);b.push(a);for(var c=function(c,d){b[b.length-1]="*"===c?a:c,this.events[c][d].apply(this,b)},d=this;d&&d.findEvents;)d.findEvents(a+",*",c),d=d.parent;return this},this.emitAfter=function(){var a=this,b=arguments;return setTimeout(function(){a.emit.apply(a,b)},0),this},this.findEvents=function(b,c){var d=b.split(a);for(var e in this.events)if(this.events.hasOwnProperty(e)&&hello.utils.indexOf(d,e)>-1)for(var f=0;f<this.events[e].length;f++)this.events[e][f]&&c.call(this,e,f)},this},globalEvent:function(a,b){return b=b||"_hellojs_"+parseInt(1e12*Math.random(),10).toString(36),window[b]=function(){try{bool=a.apply(this,arguments)}catch(c){console.error(c)}if(bool)try{delete window[b]}catch(c){}},b},popup:function(a,b,c,d){var e=document.documentElement,f=void 0!==window.screenLeft?window.screenLeft:screen.left,g=void 0!==window.screenTop?window.screenTop:screen.top,h=window.innerWidth||e.clientWidth||screen.width,i=window.innerHeight||e.clientHeight||screen.height,j=(h-c)/2+f,k=(i-d)/2+g,l=function(a){var e=window.open(a,"_blank","resizeable=true,height="+d+",width="+c+",left="+j+",top="+k);if(e&&e.addEventListener){var f=hello.utils.url(b),g=f.origin||f.protocol+"//"+f.hostname;e.addEventListener("loadstart",function(a){var b=a.url;if(0===b.indexOf(g)){var c=hello.utils.url(b),d={location:{assign:function(a){e.addEventListener("exit",function(){setTimeout(function(){l(a)},1e3)})},search:c.search,hash:c.hash,href:c.href},close:function(){e.close&&e.close()}};hello.utils.responseHandler(d,window),d.close()}})}return e&&e.focus&&e.focus(),e};return-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&(a=b+"#oauth_redirect="+encodeURIComponent(encodeURIComponent(a))),l(a)},responseHandler:function(a,b){function c(a,b,c){if(f.store(a.network,a),!("display"in a&&"page"===a.display)){if(c){var e=a.callback;try{delete a.callback}catch(g){}if(f.store(a.network,a),e in c){var h=JSON.stringify(a);try{c[e](h)}catch(g){}}}d()}}function d(){try{a.close()}catch(b){}a.addEventListener&&a.addEventListener("load",function(){a.close()})}var e,f=this,g=a.location,h=function(b){g.assign?g.assign(b):a.location=b};if(e=f.param(g.search),e&&(e.code&&e.state||e.oauth_token&&e.proxy_url)){var i=JSON.parse(e.state);e.redirect_uri=i.redirect_uri||g.href.replace(/[\?\#].*$/,"");var j=(i.oauth_proxy||e.proxy_url)+"?"+f.param(e);return void h(j)}if(e=f.merge(f.param(g.search||""),f.param(g.hash||"")),e&&"state"in e){try{var k=JSON.parse(e.state);f.extend(e,k)}catch(l){console.error("Could not decode state parameter")}if("access_token"in e&&e.access_token&&e.network)e.expires_in&&0!==parseInt(e.expires_in,10)||(e.expires_in=0),e.expires_in=parseInt(e.expires_in,10),e.expires=(new Date).getTime()/1e3+(e.expires_in||31536e3),c(e,a,b);else if("error"in e&&e.error&&e.network)e.error={code:e.error,message:e.error_message||e.error_description},c(e,a,b);else if(e.callback&&e.callback in b){var m="result"in e&&e.result?JSON.parse(e.result):!1;b[e.callback](m),d()}e.page_uri&&(a.location=e.page_uri)}else if("oauth_redirect"in e)return void h(decodeURIComponent(e.oauth_redirect))}}),hello.utils.Event.call(hello),hello.subscribe=hello.on,hello.trigger=hello.emit,hello.unsubscribe=hello.off,hello.utils.responseHandler(window,window.opener||window.parent),function(a){var b={},c={};a.on("auth.login, auth.logout",function(c){c&&"object"==typeof c&&c.network&&(b[c.network]=a.utils.store(c.network)||{})}),function d(){var e=(new Date).getTime()/1e3,f=function(b){a.emit("auth."+b,{network:g,authResponse:h})};for(var g in a.services)if(a.services.hasOwnProperty(g)){if(!a.services[g].id)continue;var h=a.utils.store(g)||{},i=a.services[g],j=b[g]||{};if(h&&"callback"in h){var k=h.callback;try{delete h.callback}catch(l){}a.utils.store(g,h);try{window[k](h)}catch(l){}}if(h&&"expires"in h&&h.expires<e){var m=i.refresh||h.refresh_token;!m||g in c&&!(c[g]<e)?m||g in c||(f("expired"),c[g]=!0):(a.emit("notice",g+" has expired trying to resignin"),a.login(g,{display:"none",force:!1}),c[g]=e+600);continue}if(j.access_token===h.access_token&&j.expires===h.expires)continue;!h.access_token&&j.access_token?f("logout"):h.access_token&&!j.access_token?f("login"):h.expires!==j.expires&&f("update"),b[g]=h,g in c&&delete c[g]}setTimeout(d,1e3)}()}(hello),hello.api=function(){function a(a){a=a.replace(/\@\{([a-z\_\-]+)(\|.+?)?\}/gi,function(a,d,e){var f=e?e.replace(/^\|/,""):"";return d in c.query?(f=c.query[d],delete c.query[d]):e||b("missing_attribute","The attribute "+d+" is missing from the request"),f}),a.match(/^https?:\/\//)||(a=i.base+a),c.url=a,e.request(c,function(a,b){if(a===!0?a={success:!0}:a||(a={}),"delete"===c.method&&(a=!a||e.isEmpty(a)?{success:!0}:a),i.wrap&&(c.path in i.wrap||"default"in i.wrap)){var f=c.path in i.wrap?c.path:"default",g=((new Date).getTime(),i.wrap[f](a,b,c));g&&(a=g)}a&&"paging"in a&&a.paging.next&&("?"===a.paging.next[0]?a.paging.next=c.path+a.paging.next:a.paging.next+="#"+c.path),d.emit("complete "+(!a||"error"in a?"error":"success"),a)})}function b(a,b){return d.emitAfter("complete error",{error:{code:a,message:b}})}var c=this.utils.args({path:"s!",query:"o",method:"s",data:"o",timeout:"i",callback:"f"},arguments),d=this.use(),e=d.utils;d.args=c,c.method=(c.method||"get").toLowerCase(),c.headers=c.headers||{},c.query=c.query||{},("get"===c.method||"delete"===c.method)&&(e.extend(c.query,c.data),c.data={});var f=c.data=c.data||{};if(d.on("complete",c.callback),!c.path)return b("invalid_path","Missing the path parameter from the request");c.path=c.path.replace(/^\/+/,"");var g=(c.path.split(/[\/\:]/,2)||[])[0].toLowerCase();if(g in d.services){c.network=g;var h=new RegExp("^"+g+":?/?");c.path=c.path.replace(h,"")}c.network=d.settings.default_service=c.network||d.settings.default_service;var i=d.services[c.network];if(!i)return b("invalid_network","Could not match the service requested: "+c.network);if(c.method in i&&c.path in i[c.method]&&i[c.method][c.path]===!1)return b("invalid_path","The provided path is not available on the selected network");c.oauth_proxy||(c.oauth_proxy=d.settings.oauth_proxy),"proxy"in c||(c.proxy=c.oauth_proxy&&i.oauth&&1===parseInt(i.oauth.version,10)),"timeout"in c||(c.timeout=d.settings.timeout),"onuploadprogress"in c||(c.onuploadprogress=function(a){d.emit("uploadprogress",a)}),"onprogress"in c||(c.onprogress=function(a){d.emit("progress",a)});var j=d.getAuthResponse(c.network);j&&j.access_token&&(c.query.access_token=j.access_token);var k,l=c.path;c.options=e.clone(c.query),c.data=e.clone(f);var m=i[{"delete":"del"}[c.method]||c.method]||{};if("get"===c.method){var n=l.split(/[\?#]/)[1];n&&(e.extend(c.query,e.param(n)),l=l.replace(/\?.*?(#|$)/,"$1"))}return(k=l.match(/#(.+)/,""))?(l=l.split("#")[0],c.path=k[1]):l in m?(c.path=l,l=m[l]):"default"in m&&(l=m["default"]),c.redirect_uri=d.settings.redirect_uri,c.oauth=i.oauth,c.xhr=i.xhr,c.jsonp=i.jsonp,c.form=i.form,"function"==typeof l?l(c,a):a(l),d},hello.utils.extend(hello.utils,{request:function(a,b){function c(a,b){var c;a.oauth&&1===parseInt(a.oauth.version,10)&&(c=a.query.access_token,delete a.query.access_token,a.proxy=!0),!a.data||"get"!==a.method&&"delete"!==a.method||(d.extend(a.query,a.data),a.data=null);var e=d.qs(a.url,a.query);a.proxy&&(e=d.qs(a.oauth_proxy,{path:e,access_token:c||"",then:"get"===a.method.toLowerCase()?"redirect":"proxy",method:a.method.toLowerCase(),suppress_response_codes:!0})),b(e)}var d=this;if(d.isEmpty(a.data)||"FileList"in window||!d.hasBinary(a.data)||(a.xhr=!1,a.jsonp=!1),"withCredentials"in new XMLHttpRequest&&(!("xhr"in a)||a.xhr&&("function"!=typeof a.xhr||a.xhr(a,a.query))))return void c(a,function(c){var e=d.xhr(a.method,c,a.headers,a.data,b);e.onprogress=a.onprogress||null,e.upload&&a.onuploadprogress&&(e.upload.onprogress=a.onuploadprogress)});var e=a.query;if(a.query=d.clone(a.query),a.callbackID=d.globalEvent(),a.jsonp!==!1){if(a.query.callback=a.callbackID,"function"==typeof a.jsonp&&a.jsonp(a,a.query),"get"===a.method)return void c(a,function(c){d.jsonp(c,b,a.callbackID,a.timeout)});a.query=e}if(a.form!==!1){a.query.redirect_uri=a.redirect_uri,a.query.state=JSON.stringify({callback:a.callbackID});var f;if("function"==typeof a.form&&(f=a.form(a,a.query)),"post"===a.method&&f!==!1)return void c(a,function(c){d.post(c,a.data,f,b,a.callbackID,a.timeout)})}b({error:{code:"invalid_request",message:"There was no mechanism for handling this request"}})},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},domInstance:function(a,b){var c="HTML"+(a||"").replace(/^[a-z]/,function(a){return a.toUpperCase()})+"Element";return b?window[c]?b instanceof window[c]:window.Element?b instanceof window.Element&&(!a||b.tagName&&b.tagName.toLowerCase()===a):!(b instanceof Object||b instanceof Array||b instanceof String||b instanceof Number)&&b.tagName&&b.tagName.toLowerCase()===a:!1},clone:function(a){if(null===a||"object"!=typeof a||a instanceof Date||"nodeName"in a||this.isBinary(a))return a;var b;if(this.isArray(a)){b=[];for(var c=0;c<a.length;c++)b.push(this.clone(a[c]));return b}b={};for(var d in a)b[d]=this.clone(a[d]);return b},xhr:function(a,b,c,d,e){function f(a){for(var b,c={},d=/([a-z\-]+):\s?(.*);?/gi;b=d.exec(a);)c[b[1]]=b[2];return c}var g=new XMLHttpRequest,h=!1;"blob"===a&&(h=a,a="GET"),a=a.toUpperCase(),g.onload=function(b){var c=g.response;try{c=JSON.parse(g.responseText)}catch(d){401===g.status&&(c={error:{code:"access_denied",message:g.statusText}})}var h=f(g.getAllResponseHeaders());h.statusCode=g.status,e(c||("GET"===a?{error:{code:"empty_response",message:"Could not get resource"}}:{}),h)},g.onerror=function(a){var b=g.responseText;try{b=JSON.parse(g.responseText)}catch(c){}e(b||{error:{code:"access_denied",message:"Could not get resource"}})};var i;if("GET"===a||"DELETE"===a)d=null;else if(d&&"string"!=typeof d&&!(d instanceof FormData)&&!(d instanceof File)&&!(d instanceof Blob)){var j=new FormData;for(i in d)d.hasOwnProperty(i)&&(d[i]instanceof HTMLInputElement?"files"in d[i]&&d[i].files.length>0&&j.append(i,d[i].files[0]):d[i]instanceof Blob?j.append(i,d[i],d.name):j.append(i,d[i]));d=j}if(g.open(a,b,!0),h&&("responseType"in g?g.responseType=h:g.overrideMimeType("text/plain; charset=x-user-defined")),c)for(i in c)g.setRequestHeader(i,c[i]);return g.send(d),g},jsonp:function(a,b,c,d){var e,f,g=this,h=0,i=document.getElementsByTagName("head")[0],j={error:{message:"server_error",code:"server_error"}},k=function(){h++||window.setTimeout(function(){b(j),i.removeChild(f)},0)};c=g.globalEvent(function(a){return j=a,!0},c),a=a.replace(new RegExp("=\\?(&|$)"),"="+c+"$1"),f=g.append("script",{id:c,name:c,src:a,async:!0,onload:k,onerror:k,onreadystatechange:function(){/loaded|complete/i.test(this.readyState)&&k()}}),window.navigator.userAgent.toLowerCase().indexOf("opera")>-1&&(e=g.append("script",{text:"document.getElementById('"+cb_name+"').onerror();"}),f.async=!1),d&&window.setTimeout(function(){j={error:{message:"timeout",code:"timeout"}},k()},d),i.appendChild(f),e&&i.appendChild(e)},post:function(a,b,c,d,e,f){var g,h=this,i=document,j=null,k=[],l=0,m=null,n=0,o=function(a){n++||d(a)};h.globalEvent(o,e);var p;try{p=i.createElement('<iframe name="'+e+'">')}catch(q){p=i.createElement("iframe")}if(p.name=e,p.id=e,p.style.display="none",c&&c.callbackonload&&(p.onload=function(){o({response:"posted",message:"Content was posted"})}),f&&setTimeout(function(){o({error:{code:"timeout",message:"The post operation timed out"}})},f),i.body.appendChild(p),h.domInstance("form",b)){for(j=b.form,l=0;l<j.elements.length;l++)j.elements[l]!==b&&j.elements[l].setAttribute("disabled",!0);b=j}if(h.domInstance("form",b))for(j=b,l=0;l<j.elements.length;l++)j.elements[l].disabled||"file"!==j.elements[l].type||(j.encoding=j.enctype="multipart/form-data",j.elements[l].setAttribute("name","file"));else{for(m in b)b.hasOwnProperty(m)&&h.domInstance("input",b[m])&&"file"===b[m].type&&(j=b[m].form,j.encoding=j.enctype="multipart/form-data");j||(j=i.createElement("form"),i.body.appendChild(j),g=j);var r;for(m in b)if(b.hasOwnProperty(m)){var s=h.domInstance("input",b[m])||h.domInstance("textArea",b[m])||h.domInstance("select",b[m]);if(s&&b[m].form===j)s&&b[m].name!==m&&(b[m].setAttribute("name",m),b[m].name=m);else{var t=j.elements[m];if(r)for(t instanceof NodeList||(t=[t]),l=0;l<t.length;l++)t[l].parentNode.removeChild(t[l]);r=i.createElement("input"),r.setAttribute("type","hidden"),r.setAttribute("name",m),s?r.value=b[m].value:h.domInstance(null,b[m])?r.value=b[m].innerHTML||b[m].innerText:r.value=b[m],j.appendChild(r)}}for(l=0;l<j.elements.length;l++)r=j.elements[l],r.name in b||r.getAttribute("disabled")===!0||(r.setAttribute("disabled",!0),k.push(r))}j.setAttribute("method","POST"),j.setAttribute("target",e),j.target=e,j.setAttribute("action",a),setTimeout(function(){j.submit(),setTimeout(function(){try{g&&g.parentNode.removeChild(g)}catch(a){try{console.error("HelloJS: could not remove iframe")}catch(b){}}for(var c=0;c<k.length;c++)k[c]&&(k[c].setAttribute("disabled",!1),k[c].disabled=!1)},0)},100)},hasBinary:function(a){for(var b in a)if(a.hasOwnProperty(b)&&this.isBinary(a[b]))return!0;return!1},isBinary:function(a){return a instanceof Object&&(this.domInstance("input",a)&&"file"===a.type||"FileList"in window&&a instanceof window.FileList||"File"in window&&a instanceof window.File||"Blob"in window&&a instanceof window.Blob)},toBlob:function(a){var b=/^data\:([^;,]+(\;charset=[^;,]+)?)(\;base64)?,/i,c=a.match(b);if(!c)return a;for(var d=atob(a.replace(b,"")),e=[],f=0;f<d.length;f++)e.push(d.charCodeAt(f));return new Blob([new Uint8Array(e)],{type:c[1]})}}),function(a){var b=a.api,c=a.utils;c.extend(c,{dataToJSON:function(a){var b=this,c=window,d=a.data;if(b.domInstance("form",d)?d=b.nodeListToJSON(d.elements):"NodeList"in c&&d instanceof NodeList?d=b.nodeListToJSON(d):b.domInstance("input",d)&&(d=b.nodeListToJSON([d])),("File"in c&&d instanceof c.File||"Blob"in c&&d instanceof c.Blob||"FileList"in c&&d instanceof c.FileList)&&(d={file:d}),!("FormData"in c&&d instanceof c.FormData))for(var e in d)if(d.hasOwnProperty(e))if("FileList"in c&&d[e]instanceof c.FileList)1===d[e].length&&(d[e]=d[e][0]);else{if(b.domInstance("input",d[e])&&"file"===d[e].type)continue;b.domInstance("input",d[e])||b.domInstance("select",d[e])||b.domInstance("textArea",d[e])?d[e]=d[e].value:b.domInstance(null,d[e])&&(d[e]=d[e].innerHTML||d[e].innerText)}return a.data=d,d},nodeListToJSON:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];!d.disabled&&d.name&&("file"===d.type?b[d.name]=d:b[d.name]=d.value||d.innerHTML)}return b}}),a.api=function(){var a=c.args({path:"s!",method:"s",data:"o",timeout:"i",callback:"f"},arguments);return a.data&&c.dataToJSON(a),b.call(this,a)}}(hello),function(){function a(a){return function(){var c=a.apply(this,arguments),d=b(function(a,b){c.on("success",a).on("error",b).on("*",function(){var a=Array.prototype.slice.call(arguments);a.unshift(a.pop()),e.emit.apply(e,a)})}),e=hello.utils.Event.call(d.proxy);return e}}Function.prototype.bind||(Function.prototype.bind=function(a){function b(){}if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=[].slice,d=c.call(arguments,1),e=this,f=function(){return e.apply(this instanceof b?this:a||window,d.concat(c.call(arguments)))};return b.prototype=this.prototype,f.prototype=new b,f});/*!
**  Thenable -- Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
**  Copyright (c) 2013-2014 Ralf S. Engelschall <http://engelschall.com>
**  Licensed under The MIT License <http://opensource.org/licenses/MIT>
**  Source-Code distributed on <http://github.com/rse/thenable>
*/
var b=function(){var a=0,b=1,c=2,d=function(b){return this instanceof d?(this.id="Thenable/1.0.6",this.state=a,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},void("function"==typeof b&&b.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new d(b)};d.prototype={fulfill:function(a){return e(this,b,"fulfillValue",a)},reject:function(a){return e(this,c,"rejectReason",a)},then:function(a,b){var c=this,e=new d;return c.onFulfilled.push(h(a,e,"fulfill")),c.onRejected.push(h(b,e,"reject")),f(c),e.proxy}};var e=function(b,c,d,e){return b.state===a&&(b.state=c,b[d]=e,f(b)),b},f=function(a){a.state===b?g(a,"onFulfilled",a.fulfillValue):a.state===c&&g(a,"onRejected",a.rejectReason)},g=function(a,b,c){if(0!==a[b].length){var d=a[b];a[b]=[];var e=function(){for(var a=0;a<d.length;a++)d[a](c)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(e):"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}},h=function(a,b,c){return function(d){if("function"!=typeof a)b[c].call(b,d);else{var e;try{e=a(d)}catch(f){return void b.reject(f)}i(b,e)}}},i=function(a,b){if(a===b||a.proxy===b)return void a.reject(new TypeError("cannot resolve promise with itself"));var c;if("object"==typeof b&&null!==b||"function"==typeof b)try{c=b.then}catch(d){return void a.reject(d)}if("function"!=typeof c)a.fulfill(b);else{var e=!1;try{c.call(b,function(c){e||(e=!0,c===b?a.reject(new TypeError("circular thenable chain")):i(a,c))},function(b){e||(e=!0,a.reject(b))})}catch(d){e||a.reject(d)}}};return d}();hello.login=a(hello.login),hello.api=a(hello.api),hello.logout=a(hello.logout)}(hello);